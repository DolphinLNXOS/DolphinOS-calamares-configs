name: MAKEPKG CI

on: [push, pull_request]

permissions:
  contents: write

jobs:
  pkgbuild:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Makepkg Build and Check
      id: makepkg
      uses: edlanglois/pkgbuild-action@v1
      with:
        pkgdir: "PKGBUILD"
    - name: Print Package Files
      run: |
        echo "Successfully created the following package archive"
        echo "Package: ${{ steps.makepkg.outputs.pkgfile0 }}"
    - name: Generate sha256sum hashes of packages
      run: |
        sha256sum ${{ steps.makepkg.outputs.pkgfile0 }} > ${{ steps.makepkg.outputs.pkgfile0 }}-sha256
    # - name: Upload to Release
    #   uses: softprops/action-gh-release@v1
    #   with:
    #     tag_name: arch-package
    #     name: "Automatic CI Builds"
    #     body: "Arch Linux package generated from project build"
    #     files: |
    #       ${{ steps.makepkg.outputs.pkgfile0 }}
    #       ${{ steps.makepkg.outputs.pkgfile0 }}-sha256
    - name: Upload to Release
      uses: ncipollo/release-action@v1
      with:
        artifacts: "${{ steps.makepkg.outputs.pkgfile0 }}, ${{ steps.makepkg.outputs.pkgfile0 }}-sha256"
        allowUpdates: "true"
        artifactErrorsFailBuild: "true"
        body: "Arch Linux package generated from project build"
        commit: "main"
        tag: "automatic-ci-builds"
 